{% extends "layout.html" %}
{% block title %} <title>Admin Dashboard</title> {% endblock %}
{% block body %}
<div style="background-color: black;" id="brandBox"></div>
<div class="container">
  <div class="card mt-5">
    <div class="card-body">
      <h1 class="text-center">Admin Panel</h1>
    </div>
  </div>
  <hr>

  <div class="card">
    <div class="card-body text-center">
      <h3 class="card-title">Users ({{users|length}}) | Posts ({{posts|length}})</h3>
    </div>
  </div>
  <hr>
  <nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
      <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button"
        role="tab" aria-controls="nav-home" aria-selected="true">Stats</button>
      <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button"
        role="tab" aria-controls="nav-profile" aria-selected="false">Notices</button>
      <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button"
        role="tab" aria-controls="nav-contact" aria-selected="false">Contact</button>
    </div>
  </nav>
  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
      <div class="card mt-3 bg-white">
        <h4 class="text-center card-header">
          <span class="float-start">Search</span>
          <!-- !Search Bar -->
          <!-- <label for="exampleDataList" class="form-label">Datalist example</label> -->
          <input class="form-control float-end mx-3" type="search" style="width: 40%;" list="datalistOptions" id="query"
            placeholder="Filter Results">
          <datalist id="datalistOptions">
          </datalist>
        </h4>
      </div>

      <div class="table-responsive">

        <table class="table table-striped table-hover" id="table" style="max-height: 300px; scroll-behavior: smooth;">
          <thead>
            <tr>
              <th onclick="sortTable(0)" scope="col">#</th>
              <th onclick="sortTable(1)" scope="col">Firstname</th>
              <th onclick="sortTable(2)" scope="col">Lastname</th>
              <th onclick="sortTable(3)" scope="col">Username</th>
              <th onclick="sortTable(4)" scope="col">Email</th>
              <th onclick="sortTable(5)" scope="col">Posts</th>
              <th onclick="sortTable(6)" scope="col">Joined</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr class="contains content search">
              <th scope="row">{{user.sno}}</th>
              <td>{{user.firstname}}  {% if user.is_verified %}  
                <i class="fa fa-check-circle text-primary" title="Verified"></i>
                {% endif %} </td>
              <td>{{user.lastname}}</td>
              <td>{{user.username}}</td>
              <td>{{user.email}}</td>
              <td>{{user.posts.all()|length}}</td>
              <td>{{user.joined_date.strftime("%B %d, %Y")}}</td>
              <td>
                {% if not user.is_admin %}
                <a id="{{user.sno}}" class="deleteUser btn rounded btn-outline-danger"> <i class="fa fa-trash"></i> </a>
                {% else %}
                  <button class="btn btn-outline-primary text-dark rounded" disabled><i class="fa fa-lock"></i></button>
                {% endif %}
                <a href="/p/{{user.username}}" class="btn rounded btn-outline-primary"> <i class="fa fa-eye"></i> </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">

      <div class="card my-3">
        <h5 class="card-header text-center"> <i class="fa fa-bullhorn text-danger"></i> Create Notices </h5>
        <div class="card-body">
          <form action="/notices/create" method="POST">
            {{form.csrf_token}}
            {{form.title.label()}}
            {{form.title(class='form-control')}}
            {{form.desc.label()}}
            {{form.desc(class='form-control')}}
            {{form.submit(class="btn btn-primary float-end mt-2" )}}
          </form>
        </div>
      </div>
      <hr>

      <div class="card my-3">
        <div class="card-body text-center">
          <h5>Notice Manager</h5>
        </div>
      </div>

      {% for notice in notices %}
      <div class="card my-3 box-shadow">
        <div class="card-body">
          <p class="card-text text-muted fw-bold float-end"> <i class="fa fa-calendar"></i>
            {{notice.create_date.strftime('%B %d , %Y')}}</p>
          <img src="{{url_for('static', filename='images/webIcon.png')}}" alt="Blogger" class="mr-3" width="30"
            height="30">
          <a class="fw-bold text-decoration-none text-dark link d-inline-block">
            Bloggers Community</a>
          <a style="text-decoration: none;">
            <h3 class="card-title">{{notice.title}}</h3>
          </a>
          <h5 class="card-title">{{notice.desc}}</h5>
          <a href="/delete/n/{{notice.sno}}" class="btn float-end btn-outline-danger rounded-circle"> <i
              class="fa fa-trash"></i> </a>
        </div>
      </div>
      {% endfor %}

      {% if notices|length == 0 %}
      <div class="alert alert-warning my-3">
        <h5>No Notices to show</h5>
      </div>
    </div>
    {%endif%}
  </div>
</div>
<div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
  
</div>
</div>


</div>


<!-- !Card -->
{% if view == "card" %}
<div class="container-fluid row">
  {% for contact in contacts %}
  <div class="card alert-{{contact.color}} my-3 mx-3" style="width: 30rem;">
    <div class="card-body content">
      <h3 class="card-title"><span class="card-text d-inline-block bg-transparent"
          style="padding: 3px;">{{counter.next()}}.</span> <i class="fa fa-user-circle-o"></i> {{contact.name}}</h3>
      <h6 class="card-subtitle mb-2 text-muted d-inline-block"><i class="fa fa-calendar-times-o"></i>
        {{contact.date}}</h6>
      <hr>
      <h5 class="card-title text-muted"><i class="fa fa-phone"></i> {{contact.tel}}</h5>
      <hr>
      <h5 class="card-title text-muted"><i class="fa fa-envelope"></i> {{contact.email}}</h5>
      <hr>
      <p class="card-title text-muted font-weight-bolder"><i class="fa fa-address-card"></i>
        {{contact.address}}</p>
    </div>
    <div class="card-footer bg-transparent">
      <a href="/edit/{{user.sno}}" class="btn btn-outline-success float-left"><i class="fa fa-pencil-square-o"></i>
        Edit</a>
      <a href="/delete/{{user.sno}}" class="btn btn-outline-danger float-right"><i class="fa fa-minus-circle"></i>
        Delete</a>
    </div>
  </div>
  {% endfor %}

  <div class="my-3 mx-3 d-flex align-items-center justify-content-center" style="width: 30rem;">
    <div class="">
      <a href="/edit/0" class="btn">
        <i class="fa fa-plus my-auto" style="font-size: 60px; opacity: 50%;"></i>
      </a>
    </div>
  </div>
</div>
{% endif %}

{% endblock %}
{% block script %}
<script>

  let deleteUser = document.querySelectorAll(".deleteUser")
  deleteUser.forEach(element => {
    element.addEventListener('click', e => {
      confirmation = confirm("Do you really want to delete this user?")
      if (confirmation) {
        location.href = `/delete/p/${e.target.id}`
      }
    })
  })

</script>
  <script src="{{url_for('static', filename='js/sort-tables.js')}}"></script>
  <script src="{{url_for('static', filename='js/searcher.js')}}"></script>
{% endblock script %}