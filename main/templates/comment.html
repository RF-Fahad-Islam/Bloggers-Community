{% extends "layout.html" %}
{% block title %}
<title></title>
{% endblock title %}
{% block body %}
<div class="container my-4">
  <div class="comment card d-block mx-auto shadow-lg w-100">
    <div class="card mx-auto" style="width: 95%;">
      <div class="card-body">
        <h2 class="fwpop text-center"> <span class="text-muted">ðŸ’¬ Discussion on :</span> <b>{{comment.post.title}}</b>
          <br>
          <a href="{{comment.post.url}}" class="btn btn-outline-secondary my-2">View Post</a>
        </h2>
      </div>
    </div>
    <div id="comment" class="my-3">
      <div class="d-flex mb-2 justify-content-center align-content-start align-items-start" style="cursor: auto;">
        <img src="{{comment.commentor.picture}}" width="35" height="35" class="rounded-circle mt-2">
        <div class="card bg-grey text-start border-1 comment">
          <div class="d-flex justify-content-between">

            <a href="{{url_for('userProfile', username=comment.commentor.username)}}"
              class="text-muted text-decoration-none hover-btn text-sm-start mb-1"
              style=" margin:0;"><b>{{comment.commentor.firstname}} {{comment.commentor.lastname}} </b>-
              {{comment.time_ago}}</a>
          </div>
          {% if edit %}
          <form action="PUT">
            <textarea name="form-control"></textarea>
          </form>
            {% else %}
          {{comment.body|safe}}
          {% endif %}

          <div class="reply">
            {% if current_user.is_authenticated %}

            <div class="replyinput mt-2 d-none" id="replyinput{{comment.sno}}">
              <form method="POST" hx-post="/comment" hx-swap="beforebegin" hx-target="#addreply{{comment.sno}}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <div class="d-flex mb-2 justify-content-center align-content-center align-items-start" id="comment"
                  style="cursor: auto;">
                  <img src="{{current_user.picture}}" width="35" height="35" class="rounded-circle mt-2">
                  <div class="bg-grey text-start comment" id="replybox{{comment.sno}}">
                    <div class="form-floating">
                      <textarea class="form-control rinput" minlength="3" maxlength="300" name="body" id="rinput"
                        placeholder="Leave a comment here" id="replyarea{{comment.sno}}"></textarea>
                      <label for="replyarea">Add a Reply âœ¨</label>
                    </div>
                    <div class="d-flex justify-content-end align-content-center">
                      <span class="btn btn-outline-secondary mt-2 mr-2 replycancel replybtn d-none"> Cancel</span>
                      <button type="submit" class="btn btn-outline-primary d-none mt-2 replybtn"><i
                          class="fa fa-commenting-o"></i> Add</button>
                    </div>
                  </div>
                  <br>
                </div>

                <input type="hidden" name="comsno" value="{{comment.sno}}">
              </form>
            </div>

            {% endif %}
            <!-- <span class="float-end mx-2 d-inline-block hover-btn"><i class="fa fa-comment-o"></i></span> -->
            <!-- !All the replies to the comment thread -->
            <div id="addreply{{comment.sno}}"></div>
            {% if comment.replies %}
            {% for reply in comment.replies %}

            <div class="d-flex my-2 justify-content-center align-content-start align-items-start" style="cursor: auto;">
              <img src="{{reply.commentor.picture}}" width="35" height="35" class="rounded-circle mt-2">
              <div class="card bg-grey text-start border-1 comment">
                <a href="{{url_for('userProfile', username=reply.commentor.username)}}"
                  class="text-muted btn-link text-decoration-none text-sm-start mb-1"
                  style=" margin:0;"><b>{{reply.commentor.firstname}} {{reply.commentor.lastname}} </b>-
                  {{reply.time_ago}}</a>
                {{reply.body|safe}}
              </div>
            </div>
            {% endfor %}
            {% endif %}
          </div>
          {% if current_user.is_authenticated %}

          <div class="card-text">
            <button class="card-text  btn hover-btn reply" id="{{comment.sno}}"><i class="fa fa-comment-o"></i>
              Reply</button>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% endblock body %}

  {% block script %}
  <script>

    $('#sendbtn').click(() => {
      setTimeout(() => {
        document.getElementById('tbody').value = ""
      }, 500)
    })
    $('.replybtn').click(() => {
      setTimeout(() => {
        document.getElementById('rinput').value = ""
      }, 500)
    })


    $('#tbody').focusin(() => {
      $('#sendbtn').removeClass('d-none')
      $('#sendbtn').addClass('d-inline-block')

    })
    $('.rinput').focusin(() => {
      $('.replybtn').removeClass('d-none')
      $('.replybtn').addClass('d-inline-block')

    })


    $('button.reply').click((e) => {
      selector = `#replyinput${e.target.id}`
      $(selector).removeClass('d-none')
      console.log(e)
    })

    $('.replycancel').click(() => {
      $('.replyinput').addClass('d-none')
    })
  </script>
  {% endblock script %}